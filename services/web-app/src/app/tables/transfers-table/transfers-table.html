<div class="container">
  <div class="card">
    <div class="header">
      <h1>Extrato bancário</h1>
      <p>Visualize suas transferências e depósitos</p>
    </div>

    <!-- FILTROS -->
    <div class="filtros">
      <div class="filtro-destinatario">
        <label for="destinatario">Destinatário:</label>
        <input
          type="text"
          id="destinatario"
          placeholder="Buscar por nome..."
          [(ngModel)]="filtros.destinatario"
          (ngModelChange)="aplicarFiltros()"
        />
      </div>

      <div class="filtros-horizontal">
        <div class="filtro-grupo">
          <label for="operationType">Tipo de Operação:</label>
          <select id="operationType" [(ngModel)]="filtros.operationType" (ngModelChange)="aplicarFiltros()">
            <option value="">Todas</option>
            <option value="Deposit">Depósito</option>
            <option value="TransferSend">Transferência enviada</option>
            <option value="TransferReceive">Transferência recebida</option>
            <option value="InvestmentsToSavings">Investimento → Poupança</option>
            <option value="SavingsToInvestments">Poupança → Investimento</option>
          </select>
        </div>

        <div class="filtro-grupo">
          <label for="dataMin">Data Mínima:</label>
          <input type="date" id="dataMin" [(ngModel)]="filtros.dataMin" (ngModelChange)="aplicarFiltros()" />
        </div>

        <div class="filtro-grupo">
          <label for="dataMax">Data Máxima:</label>
          <input type="date" id="dataMax" [(ngModel)]="filtros.dataMax" (ngModelChange)="aplicarFiltros()" />
        </div>

        <div class="filtro-grupo">
          <label for="valorMin">Valor Mínimo:</label>
          <input type="number" id="valorMin" [(ngModel)]="filtros.valorMin"
                 (ngModelChange)="aplicarFiltros()" step="0.01" placeholder="R$ 0,00" />
        </div>

        <div class="filtro-grupo">
          <label for="valorMax">Valor Máximo:</label>
          <input type="number" id="valorMax" [(ngModel)]="filtros.valorMax"
                 (ngModelChange)="aplicarFiltros()" step="0.01" placeholder="R$ 0,00" />
        </div>

        <button class="btn-limpar" (click)="limparFiltros()">Limpar Filtros</button>
      </div>
    </div>

    <!-- TABELA -->
    <div class="content">
      <table>
        <thead>
        <tr>
          <th>Data</th>
          <th>Operação</th>
          <th>Remetente</th>
          <th>Destinatário</th>
          <th>CPF</th>
          <th class="text-right">Valor</th>
        </tr>
        </thead>

        <tbody>
        <tr *ngFor="let transacao of transacoesFiltradas">
          <td>{{ formatarData(transacao.date) }}</td>

          <td class="operacao">
            {{
              transacao.operationType === 'Deposit' ? 'Depósito' :
                transacao.operationType === 'TransferSend' ? 'Transferência enviada' :
                  transacao.operationType === 'TransferReceive' ? 'Transferência recebida' :
                    transacao.operationType === 'InvestmentsToSavings' ? 'Investimento → Poupança' :
                      transacao.operationType === 'SavingsToInvestments' ? 'Poupança → Investimento' :
                        transacao.operationType
            }}
          </td>

          <td>{{ transacao.senderName }}</td>
          <td>{{ transacao.receiverName }}</td>
          <td>{{ transacao.receiverCpf }}</td>

          <td
            class="valor"
            [ngClass]="{
              negativo: transacao.operationType === 'TransferSend' ||
                        transacao.operationType === 'SavingsToInvestments',
              positivo: transacao.operationType === 'Deposit' ||
                        transacao.operationType === 'TransferReceive' ||
                        transacao.operationType === 'InvestmentsToSavings'
            }"
          >
            {{ transacao.operationType === 'TransferSend' ||
          transacao.operationType === 'SavingsToInvestments'
            ? '-' + formatarValor(transacao.amount)
            : formatarValor(transacao.amount)
            }}
          </td>
        </tr>

        <tr *ngIf="transacoesFiltradas.length === 0">
          <td colspan="6" class="empty">Nenhuma transação disponível</td>
        </tr>
        </tbody>
      </table>

      <div class="footer">
        <p>Total de transações: <strong>{{ transacoesFiltradas.length }}</strong></p>
        <p class="total">
          <span>Volume total: </span>
          <strong>{{ formatarValor(valorTotal) }}</strong>
        </p>
      </div>
    </div>
  </div>
</div>
