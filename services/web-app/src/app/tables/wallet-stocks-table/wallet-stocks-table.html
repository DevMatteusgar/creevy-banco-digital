<!-- wallet-stocks-table.html -->
<div class="my-stocks-container">
  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <h1>Minhas A√ß√µes</h1>
      <p class="subtitle">Gerencie seu portf√≥lio de investimentos</p>
    </div>
    <button class="refresh-btn" (click)="loadMyStocks()">
      <span class="icon">üîÑ</span>
      Atualizar
    </button>
  </div>

  <!-- Summary Card -->
  <div class="summary-card">
    <div class="summary-header">
      <span class="icon">üìà</span>
      <h3>Valor Total do Portf√≥lio</h3>
    </div>
    <p class="total-portfolio">{{ calculateTotalValue() | currency:'BRL' }}</p>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
    <p>Carregando suas a√ß√µes...</p>
  </div>

  <!-- Error -->
  <div *ngIf="error && !loading" class="error-message">
    <span class="error-icon">‚ö†Ô∏è</span>
    {{ error }}
  </div>

  <!-- Tabela -->
  <div *ngIf="!loading && !error && myStocks.length > 0" class="table-container">
    <table class="stocks-table">
      <thead>
      <tr>
        <th class="th-code">C√≥digo</th>
        <th class="th-name">Nome da A√ß√£o</th>
        <th class="th-quantity">Quantidade</th>
        <th class="th-price">Pre√ßo Unit√°rio</th>
        <th class="th-total">Valor Total</th>
        <th class="th-actions">A√ß√µes</th>
      </tr>
      </thead>

      <tbody>
      <ng-container *ngFor="let stock of myStocks; let i = index">

        <!-- LINHA PRINCIPAL -->
        <tr [class.selected-row]="selectedStockIndex === i">
          <td class="td-code">
            <span class="stock-code">{{ stock.stockIdentifier }}</span>
          </td>
          <td class="td-name">
            <span class="stock-name">{{ stock.stockName }}</span>
          </td>
          <td class="td-quantity">
            <span class="quantity-badge">{{ stock.stockQuantity }}</span>
          </td>
          <td class="td-price">{{ stock.stockPrice | currency:'BRL' }}</td>
          <td class="td-total">
            <span class="total-value">{{ stock.stockTotalValue | currency:'BRL' }}</span>
          </td>
          <td class="td-actions">
            <button
              class="sell-btn"
              [class.active]="selectedStockIndex === i"
              (click)="toggleSellForm(i, stock)">
              <span *ngIf="selectedStockIndex !== i">Vender</span>
              <span *ngIf="selectedStockIndex === i">‚úï Cancelar</span>
            </button>
          </td>
        </tr>

        <!-- FORM EXPANDIDO -->
        <tr *ngIf="selectedStockIndex === i" class="sell-row">
          <td colspan="6">
            <div class="sell-form-container">
              <h4>Vender {{ stock.stockName }} ({{ stock.stockIdentifier }})</h4>

              <!-- Mensagem de Erro -->
              <div *ngIf="sellErrorMessage" class="sell-error-message">
                <span class="error-icon-inline">‚ö†Ô∏è</span>
                <span>{{ sellErrorMessage }}</span>
              </div>

              <div class="sell-form-card">
                <div class="form-group">
                  <label>Quantidade a vender</label>
                  <input
                    type="number"
                    [(ngModel)]="sellForm.stockQuantity"
                    [min]="1"
                    [max]="stock.stockQuantity"
                    [class.input-error]="sellErrorMessage"
                    class="sell-input"
                    placeholder="Digite a quantidade"
                    (input)="sellErrorMessage = ''"
                  />
                  <p class="input-helper">Dispon√≠vel: {{ stock.stockQuantity }} a√ß√µes</p>
                </div>

                <!-- Valor Estimado -->
                <div *ngIf="sellForm.stockQuantity > 0" class="estimated-value-card">
                  <div class="estimated-row">
                    <span class="estimated-label">Valor estimado:</span>
                    <span class="estimated-amount">{{ calculateEstimatedValue() | currency:'BRL' }}</span>
                  </div>
                  <p class="estimated-calculation">
                    {{ sellForm.stockQuantity }} √ó {{ stock.stockPrice | currency:'BRL' }}
                  </p>
                </div>

                <button
                  class="confirm-sell-btn"
                  (click)="submitSell()"
                  [disabled]="sellLoading || sellForm.stockQuantity <= 0">
                  <span *ngIf="!sellLoading">Confirmar Venda</span>
                  <span *ngIf="sellLoading">Processando...</span>
                </button>
              </div>
            </div>
          </td>
        </tr>

      </ng-container>
      </tbody>
    </table>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && !error && myStocks.length === 0" class="empty-state">
    <div class="empty-icon">üìä</div>
    <h3>Voc√™ ainda n√£o possui a√ß√µes</h3>
    <p>Comece a investir agora e acompanhe seu portf√≥lio aqui.</p>
  </div>
</div>
